(function(){var e,n,t,r,i,o;window.api_call=function(e,n,t,r,i){var o,u,a;i=i||r||t,r=r||t,4===arguments.length&&(r=void 0),3===arguments.length&&(t=void 0,r=void 0),t=t||{};for(o in t)a=t[o],null==a&&delete t[o];return u=n.search("\\?")>=0?"&":"?",$.ajax({type:e,url:""+n+u+$.param(t),contentType:"application/json",accepts:"application/json",dataType:"json",data:r?JSON.stringify(r):void 0,success:function(n){var t;return"success"===n.status?(t=void 0,n.next_url&&(t=function(t){return api_call(e,n.next_url,{},t)}),"function"==typeof i?i(void 0,n.result,t):void 0):"function"==typeof i?i(n):void 0},error:function(e,n,t){var r,o;o={error_code:"ajax_error",text_status:n,error_thrown:t,jqXHR:e};try{e.responseText&&(o=$.parseJSON(e.responseText))}catch(u){r=u,o=o}return LOG("api_call error",o),"function"==typeof i?i(o):void 0}})},window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_password_show_button(),init_time(),init_announcement()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_password_show_button=function(){return $("body").on("click",".btn-password-show",function(){var e;return e=$($(this).data("target")),e.focus(),$(this).hasClass("active")?e.attr("type","password"):e.attr("type","text")})},window.init_time=function(){var e;return $("time").length>0?(e=function(){return $("time[datetime]").each(function(){var e,n;return e=moment.utc($(this).attr("datetime")),n=moment().diff(e,"days"),$(this).text(n>25?e.local().format("YYYY-MM-DD"):e.fromNow()),$(this).attr("title",e.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)})():void 0},window.init_announcement=function(){return $(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html()?$(".alert-announcement").show():void 0},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(e,n){return null==n&&(n="warning"),clear_notifications(),e?$("#notifications").append('<div class="alert alert-dismissable alert-'+n+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+e+"\n</div>"):void 0},$(function(){return init_common()}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.profile").each(function(){return init_profile()})}),$(function(){return $("html.auth").each(function(){return init_auth()})}),$(function(){return $("html.feedback").each(function(){})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})}),window.init_admin_config=function(){},window.init_profile=function(){},window.init_auth=function(){return $(".remember").change(function(){var e,n,t,r,i,o;for(n=$(".btn-social").toArray().concat($(".btn-social-icon").toArray()),o=[],r=0,i=n.length;i>r;r++)e=n[r],t=$(e).prop("href"),$(".remember input").is(":checked")?($(e).prop("href",t+"&remember=true"),o.push($("#remember").prop("checked",!0))):($(e).prop("href",t.replace("&remember=true","")),o.push($("#remember").prop("checked",!1)));return o}),$(".remember").change()},window.init_user_list=function(){return t(),e(),n()},t=function(){return $("input[name=user_db]").each(function(){return o($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return o($(this))})}),$("input[name=user_db]").change(function(){return o($(this))})},o=function(e){return i(),$("input[name=user_db]").each(function(){var n;return n=e.val(),$("#"+n).toggleClass("warning",e.is(":checked"))})},i=function(){var e;return e=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===e),$("#user-merge").toggleClass("hidden",2>e),0===e?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},e=function(){return $("#user-delete").click(function(e){var n,t,r,o;return clear_notifications(),e.preventDefault(),n=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),t=$(this).data("api-url"),o=$(this).data("success"),r=$(this).data("error"),swal({title:"Delete?",text:n,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Yes",closeOnConfirm:!1},function(){var e;return e=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),e.push($(this).val())}),api_call("DELETE",t,{user_keys:e.join(",")},function(n,t){return n?($("input[name=user_db]:disabled").removeAttr("disabled"),void swal("Failed!",r.replace("{users}",e.length),"error")):$("#"+t.join(", #")).fadeOut(function(){return $(this).remove(),i(),swal("Deleted!",o.replace("{users}",e.length),"success")})})})})},window.init_user_merge=function(){var e,n;return n=$("#user_keys").val(),e=$(".api-url").data("api-url"),api_call("GET",e,{user_keys:n},function(e,n){return e?void LOG("Something went terribly wrong"):(window.user_dbs=n,$("input[name=user_db]").removeAttr("disabled"))}),$("input[name=user_db]").change(function(e){var n;return n=$(e.currentTarget).val(),r(n)})},r=function(e){var n,t,r,i;for($(".user-row").removeClass("success").addClass("danger"),$("#"+e).removeClass("danger").addClass("success"),r=[],n=0,t=user_dbs.length;t>n;n++){if(i=user_dbs[n],e===i.key){$("input[name=user_key]").val(i.key),$("input[name=username]").val(i.username),$("input[name=name]").val(i.name),$("input[name=email]").val(i.email);break}r.push(void 0)}return r},n=function(){return $("#user-merge").click(function(e){var n,t;return e.preventDefault(),n=[],$("input[name=user_db]:checked").each(function(){return n.push($(this).val())}),t=$(this).data("user-merge-url"),window.location.href=t+"?user_keys="+n.join(",")})}}).call(this);